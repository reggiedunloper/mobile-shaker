<!doctype html>
<html>
  <head>
    <title>Mobile Shaker Test</title>
  </head>
  <body>
    <main>
      <h1>Test Shaker 1</h1>
      <h1 id="random"></h1>
      <h2>0</h2>
      <p id="status"></p>
      <p id="state">0</p>
    </main>
    <script>

      let totalvalue = Number(document.querySelector('h2').innerText);
      let state = 0;

      let intervalid = setInterval(checkMovement, 500);

      function checkMovement() {
        console.log(state);
        document.querySelector('#state').innerText = state;

        if(state === 0 && totalvalue > 1000) {
          // you've rolled enough, give us a random value
          let randomvalue = Math.random()*100;
          document.querySelector('#random').innerText = randomvalue;
          // reset total for next roll
          totalvalue = 0;
          document.querySelector('#status').innerText = "STOPPED";
        }
      }

      function updateTotal(amount) {
        if (amount > 10) {
          state = 1;
          let currvalue = Number(document.querySelector('h2').innerText)
          currvalue = currvalue + amount
          document.querySelector('h2').innerText = currvalue
        } else {
          state = 0;
        }
      }

      function handleMotionEvent(event) {
        console.log(event);
        var xmovement = Math.abs(event.acceleration.x);
        var ymovement = Math.abs(event.acceleration.y);
        var zmovement = Math.abs(event.acceleration.z);

        updateTotal(xmovement + ymovement + zmovement);

      }

      function testclick(event) {

        updateTotal(100);

      }

      window.addEventListener("devicemotion", handleMotionEvent, true);
      window.addEventListener("click", testclick, true);
    </script>
  </body>
</html>